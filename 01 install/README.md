#### Введение в Keycloak
- **Keycloak** — это инструмент управления идентификацией и доступом с открытым исходным кодом, ориентированный на современные приложения, такие как одностраничные приложения (SPA), мобильные приложения и REST API.
- Проект был запущен в 2014 году с акцентом на упрощение защиты приложений для разработчиков. Сейчас он используется в различных сценариях — от небольших сайтов до крупных предприятий с миллионами пользователей.
- Keycloak предоставляет полностью настраиваемые страницы входа, поддержку сильной аутентификации, восстановление паролей, регулярное обновление паролей, принятие условий использования и многое другое без необходимости написания кода.
- Все страницы поддерживают пользовательские темы, что позволяет легко изменять их внешний вид.

#### Преимущества Keycloak:
- **Безопасность**: Приложения не имеют прямого доступа к учетным данным пользователей; им предоставляются токены безопасности.
- **Многофакторная аутентификация (MFA)**: Поддерживает OTP, устройства безопасности, WebAuthn, пароли и их комбинации.
- **Единый вход (SSO)**: Пользователи могут получить доступ к нескольким приложениям, проходя аутентификацию только один раз.
- **Стандартные протоколы**: OAuth 2.0, OpenID Connect, SAML 2.0.
- **Интеграция**: Может работать с существующими базами данных пользователей, такими как Active Directory и LDAP.

#### Установка и запуск Keycloak

##### Опции установки:
1. **Docker** (рекомендуемый способ):
   ```bash
   docker run -e KEYCLOAK_ADMIN=admin -e KEYCLOAK_ADMIN_PASSWORD=admin -p 8080:8080 quay.io/keycloak/keycloak:22.0.0 start-dev
   ```
   - После запуска можно проверить работу через `http://localhost:8080/admin` с логином `admin` и паролем `admin`.

2. **Локальная установка**:
   - Требуется Java Virtual Machine (например, OpenJDK версии 17).
   - Скачайте дистрибутив Keycloak с официального сайта и распакуйте его.
   - Запустите Keycloak командой:
     ```bash
     export KEYCLOAK_ADMIN=admin
     export KEYCLOAK_ADMIN_PASSWORD=admin
     cd $KC_HOME
     bin/kc.sh start-dev
     ```

3. **Kubernetes**:
   - Можно использовать Keycloak Kubernetes Operator для упрощения установки, настройки и управления.

#### Консоли Keycloak:

1. **Административная консоль**:
   - Доступна по адресу `http://localhost:8080/admin`.
   - Предоставляет интерфейс для настройки и управления Keycloak.

2. **Консоль учетных записей**:
   - Доступна по адресу `http://localhost:8080/realms/myrealm/account`.
   - Позволяет пользователям управлять своими учетными записями, включая обновление профиля, изменение пароля, включение двухфакторной аутентификации, просмотр приложений и активных сессий.

#### Базовая настройка Keycloak

1. **Создание реалма (Realm)**:
   - Реалм — это изолированное пространство с собственными настройками, приложениями и пользователями.
   - Создается через административную консоль.

2. **Создание пользователя**:
   - Через раздел "Users" создается новый пользователь.
   - Необходимо задать временный пароль, который пользователь должен будет изменить при первом входе.

3. **Создание группы**:
   - Группы позволяют объединять пользователей и назначать им общие атрибуты и роли.
   - Создаются через раздел "Groups".

4. **Создание глобальной роли**:
   - Роли определяют права доступа.
   - Создаются через раздел "Realm roles".
   - Роли могут быть составными, то есть включать другие роли.

#### Итоги:
- Keycloak предоставляет готовое решение для управления идентификацией и доступом.
- Легко устанавливается и настраивается.
- Имеет мощные возможности для расширения и настройки под конкретные нужды.

