# Краткое введение в стандарты

Индустриальные стандарты, которые позволяют   безопасно и легко интегрировать ваши приложения с Keycloak.  кратко рассмотрим **OAuth 2.0**, **OpenID Connect**, **JSON Web Tokens (JWT)** и **Security Assertion Markup Language 2.0 (SAML 2.0)**.



## Основные темы:

- Авторизация доступа приложений с помощью OAuth 2.0
- Аутентификация пользователей с помощью OpenID Connect
- Использование JWT для токенов
- Понимание того, почему SAML 2.0 всё ещё актуален

## Авторизация доступа приложений с помощью OAuth 2.0

**OAuth 2.0** на сегодняшний день является чрезвычайно популярным отраслевым стандартным протоколом для авторизации.

В основе **OAuth 2.0** лежит фреймворк **OAuth 2.0**, который позволил создать целую экосистему сайтов, интегрирующихся друг с другом. До появления **OAuth 2.0** существовал **OAuth 1.0**, а также более специализированные решения для предоставления третьим сторонам доступа к данным от имени пользователя, но эти подходы были сложными или не легко взаимодействующими.

С **OAuth 2.0** обмен данными пользователя с третьими сторонами прост, не требует передачи учетных данных пользователя и позволяет контролировать какие данные передаются.

### Роли в OAuth 2.0:

- **Владелец ресурса**: обычно конечный пользователь, который владеет ресурсами, к которым приложение хочет получить доступ.
- **Сервер ресурсов**: служба, предоставляющая защищенные ресурсы.
- **Клиент**: приложение, которое хотело бы получить доступ к ресурсу.
- **Сервер авторизации**: сервер, предоставляющий доступ клиенту, роль которого выполняет Keycloak.

### Основной поток OAuth 2.0:

1. Клиент запрашивает доступ к ресурсу от имени владельца ресурса у сервера авторизации.
2. Сервер авторизации предоставляет ограниченный доступ к ресурсу в виде токена доступа.
3. После получения токена доступа клиент может получить доступ к ресурсу на сервере ресурсов, включая токен доступа в запрос.

### Типы потоков OAuth 2.0:

- **Client Credentials flow**: используется, когда приложение само является владельцем ресурса.
- **Device flow**: используется для устройств без браузера или с ограниченным вводом (например, смарт-телевизор).
- **Authorization code flow**: используется, если ни одно из предыдущих условий не применимо.

> Не рекомендуется использовать:
> - **Implicit flow**: считается небезопасным.
> - **Resource Owner Password Credentials flow**: внутренне небезопасен, так как раскрывает учетные данные пользователя приложению.

## Аутентификация пользователей с помощью OpenID Connect

Хотя **OAuth 2.0** является протоколом для авторизации, он не охватывает аутентификацию. **OpenID Connect** строится поверх **OAuth 2.0**, добавляя уровень аутентификации.

### Основные роли в OpenID Connect:

- **End User**: человек, который проходит аутентификацию.
- **Relying Party (RP)**: приложение, которое хочет аутентифицировать конечного пользователя.
- **OpenID Provider (OP)**: провайдер удостоверений, который аутентифицирует пользователя.

### Основной поток OpenID Connect:

1. Приложение отправляет запрос аутентификации и перенаправляет браузер пользователя на Keycloak.
2. Keycloak аутентифицирует пользователя.
3. Приложение получает код авторизации.
4. Приложение обменивает код авторизации на ID токен и токен доступа.

Основное отличие от **OAuth 2.0** — это использование параметра `scope=openid`, который делает запрос аутентификационным, а не авторизационным.

## Использование JWT для токенов

Keycloak использует **JSON Web Tokens (JWT)** в качестве формата для токенов доступа с самого начала проекта. Это было осознанное решение ради совместимости и производительности.

### Преимущества использования JWT:

- Легкость интеграции благодаря стандартному формату JSON.
- Устранение необходимости делать дополнительные запросы к серверу авторизации для проверки токена.

### Проверка JWT:

1. Получение URL JWKS из конечной точки обнаружения OpenID Connect.
2. Скачивание публичных ключей подписи для OP.
3. Проверка подписи токена с использованием публичных ключей.

> Важно избегать уязвимостей, таких как `alg=none` и использование RSA для HMAC.

## Почему SAML 2.0 всё ещё актуален

Несмотря на то, что **SAML 2.0** более зрелый и, возможно, более широко используемый, вы всё же можете предпочесть **OpenID Connect** для новых приложений. Однако **SAML 2.0** остаётся важным стандартом, особенно в корпоративных средах, где часто требуется поддержка старых систем.

---

### Резюме

- **OAuth 2.0** используется для авторизации доступа приложений без раскрытия учетных данных.
- **OpenID Connect** добавляет аутентификацию пользователей поверх OAuth 2.0.
- **JWT** используется как формат токенов для удобства и производительности.
- **SAML 2.0** всё ещё актуален, особенно в корпоративных средах.

